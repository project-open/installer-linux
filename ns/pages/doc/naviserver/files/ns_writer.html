
<html><head>
<title>ns_writer - NaviServer Built-in Commands</title>
<link rel="stylesheet" href="../man.css" type="text/css">
</head>
<! -- Generated from file '/usr/local/src/naviserver/doc/html/naviserver/files/ns_writer.html' by tcllib/doctools with format 'html'
   -->
<! -- CVS: $Id$ ns_writer.n
   -->
<body><div class="doctools">
<div id="man-header">
  <a href="http://wiki.tcl.tk/2090"><img
     src="http://naviserver.sourceforge.net/ns-icon-16.png"> <strong>NaviServer</strong></a>
  - programmable web server
</div>
<br>
<hr> [
  <a href="../../toc.html">Main Table Of Contents</a>
| <a href="../toc.html">Table Of Contents</a>
| <a href="../../index.html">Keyword Index</a>
] <hr>
<h1 class="title">ns_writer(n) 4.99.8 naviserver &quot;NaviServer Built-in Commands&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>ns_writer - Manage files with writer thread</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">COMMANDS</a></li>
<li class="section"><a href="#section3">CONFIGURATION</a></li>
<li class="section"><a href="#section4">EXAMPLES</a></li>
<li class="section"><a href="#see-also">See Also</a></li>
<li class="section"><a href="#keywords">Keywords</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="syntax">
<li><a href="#1"><b class="cmd">ns_writer</b> <i class="arg">list</i> <span class="opt">?<i class="arg">-server s</i>?</span></a></li>
<li><a href="#2"><b class="cmd">ns_writer</b> <i class="arg">submit</i> <i class="arg">data</i></a></li>
<li><a href="#3"><b class="cmd">ns_writer</b> <i class="arg">submitfile</i> <span class="opt">?<i class="arg">-headers</i>?</span> <span class="opt">?<i class="arg">-offset offset</i>?</span> <span class="opt">?<i class="arg">-size size</i>?</span> <i class="arg">file</i></a></li>
<li><a href="#4"><b class="cmd">ns_writer size</b> <i class="arg">driver</i> <span class="opt">?<i class="arg">value</i>?</span></a></li>
<li><a href="#5"><b class="cmd">ns_writer streaming</b> <i class="arg">driver</i> <span class="opt">?<i class="arg">value</i>?</span></a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>This command allows to submit data or file to be returned to the client connection using writer
thread instead of current connection thread. Writer thread processes multiple sockets using async socket
operations which consumes less resources than returning multiple files to the slow clients in separate thread.</p>
</div>
<div id="section2" class="section"><h2><a name="section2">COMMANDS</a></h2>
<dl class="definitions">
<dt><a name="1"><b class="cmd">ns_writer</b> <i class="arg">list</i> <span class="opt">?<i class="arg">-server s</i>?</span></a></dt>
<dd><p>Returns list of all currently submitted files. Every list entry
contains the start time of the initiating request, name of the thread,
driver, the ip-address of the requestor, the file descriptor, the
remaining size and the bytes already sent, and the client data as
provided via [ns_conn clientdata]. If <i class="arg">-server</i> is
specified, only the submitted file entries from the specified server
are returned.</p></dd>
<dt><a name="2"><b class="cmd">ns_writer</b> <i class="arg">submit</i> <i class="arg">data</i></a></dt>
<dd><p>Submit arbitrary data to be returned via writer thread, data can be binary.</p></dd>
<dt><a name="3"><b class="cmd">ns_writer</b> <i class="arg">submitfile</i> <span class="opt">?<i class="arg">-headers</i>?</span> <span class="opt">?<i class="arg">-offset offset</i>?</span> <span class="opt">?<i class="arg">-size size</i>?</span> <i class="arg">file</i></a></dt>
<dd><p>Submits file to be returned via writer thread. For parital requests,
ns_writer does NOT change status code or sets content-range.
Optionally the following arguments can be used:</p>
<p><i class="arg">-headers</i>
Tells the writer to provide required HTTP headers, like content size, type and status.</p>
<p><i class="arg">-offset</i>
If specified, file will be returned starting with this offset.</p>
<p><i class="arg">-size</i>
If not specified, the whole file will be retuned, otherwise only given
part. Can be combined with <i class="arg">-offset</i>.</p></dd>
<dt><a name="4"><b class="cmd">ns_writer size</b> <i class="arg">driver</i> <span class="opt">?<i class="arg">value</i>?</span></a></dt>
<dd><p>Query or set configuration parameter <i class="term">writersize</i> of the writer(s) of
the specified driver.</p></dd>
<dt><a name="5"><b class="cmd">ns_writer streaming</b> <i class="arg">driver</i> <span class="opt">?<i class="arg">value</i>?</span></a></dt>
<dd><p>Query or set configuration parameter <i class="term">writerstreaming</i> of the writer(s) of
the specified driver.</p></dd>
</dl>
</div>
<div id="section3" class="section"><h2><a name="section3">CONFIGURATION</a></h2>
<p><em>Basic configuration options:</em></p>
<dl class="definitions">
<dt>ns_section &quot;ns/server/default/module/nssock&quot;</dt>
<dd></dd>
<dt>ns_param writerthreads 1</dt>
<dd></dd>
<dt>ns_param writersize 4096</dt>
<dd></dd>
<dt>ns_param writerstreaming true</dt>
<dd></dd>
</dl>
<p><i class="term">writerthreads</i> parameter specified how many writer threads will be used, multiple threads
will be rotated to spread the load across all threads</p>
<p><i class="term">writersize</i> specifies the minimal size of the file to be considered for writer thread, this parameter
is used by connection thread when returning file and if size exceeds configured value, file will be 
returned via writer thread and connection thread will be released to handle other requests.</p>
<p><i class="term">writerstreaming</i> specifies whether or not streaming HTML output (e.g. sent
via <b class="cmd"><a href="ns_write.html">ns_write</a></b>) should be sent via the writer. 
When sending server responses over slow connections, this
option reduces the blocking time of the connection threads and can
therfore reduce the damage of slow-read attacks.</p>
</div>
<div id="section4" class="section"><h2><a name="section4">EXAMPLES</a></h2>
<pre class="example">
ns_writer submitfile /tmp/biglist.txt
</pre>
</div>
<div id="see-also" class="section"><h2><a name="see-also">See Also</a></h2>
<p><a href="ns_conn.html">ns_conn</a>, ns_returnfile, <a href="ns_write.html">ns_write</a></p>
</div>
<div id="keywords" class="section"><h2><a name="keywords">Keywords</a></h2>
<p><a href="../../index.html#key9">configuration</a>, <a href="../../index.html#key31">writer</a></p>
</div>
<div id="man-footer">
  
</div>
</div></body></html>
