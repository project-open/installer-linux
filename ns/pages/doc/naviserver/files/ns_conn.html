
<html><head>
<title>ns_conn - NaviServer Built-in Commands</title>
<link rel="stylesheet" href="../man.css" type="text/css">
</head>
<! -- Generated from file '/usr/local/src/naviserver/doc/html/naviserver/files/ns_conn.html' by tcllib/doctools with format 'html'
   -->
<! -- CVS: $Id$ ns_conn.n
   -->
<body><div class="doctools">
<div id="man-header">
  <a href="http://wiki.tcl.tk/2090"><img
     src="http://naviserver.sourceforge.net/ns-icon-16.png"> <strong>NaviServer</strong></a>
  - programmable web server
</div>
<br>
<hr> [
  <a href="../../toc.html">Main Table Of Contents</a>
| <a href="../toc.html">Table Of Contents</a>
| <a href="../../index.html">Keyword Index</a>
] <hr>
<h1 class="title">ns_conn(n) 4.99.8 naviserver &quot;NaviServer Built-in Commands&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>ns_conn - Find information about the current HTTP connection</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">COMMANDS</a></li>
<li class="section"><a href="#section3">EXAMPLES</a></li>
<li class="section"><a href="#see-also">See Also</a></li>
<li class="section"><a href="#keywords">Keywords</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="syntax">
<li><a href="#1"><b class="cmd">ns_conn</b> <i class="arg">option</i> <span class="opt">?<i class="arg">arg arg ...</i>?</span></a></li>
<li><a href="#2"><b class="cmd">ns_conn auth</b></a></li>
<li><a href="#3"><b class="cmd">ns_conn authpassword</b></a></li>
<li><a href="#4"><b class="cmd">ns_conn authuser</b></a></li>
<li><a href="#5"><b class="cmd">ns_conn channel</b></a></li>
<li><a href="#6"><b class="cmd">ns_conn clientdata</b> <span class="opt">?<i class="arg">value</i>?</span></a></li>
<li><a href="#7"><b class="cmd">ns_conn close</b></a></li>
<li><a href="#8"><b class="cmd">ns_conn compress</b> <span class="opt">?<i class="arg">level</i>?</span></a></li>
<li><a href="#9"><b class="cmd">ns_conn content</b> <span class="opt">?<b class="option">-binary</b>?</span> <span class="opt">?<i class="arg">offset</i>?</span> <span class="opt">?<i class="arg">length</i>?</span></a></li>
<li><a href="#10"><b class="cmd">ns_conn contentfile</b></a></li>
<li><a href="#11"><b class="cmd">ns_conn contentlength</b></a></li>
<li><a href="#12"><b class="cmd">ns_conn contentsentlength</b> <span class="opt">?<i class="arg">bytes</i>?</span></a></li>
<li><a href="#13"><b class="cmd">ns_conn copy</b> <i class="arg">off</i> <i class="arg">len</i> <i class="arg">chan</i></a></li>
<li><a href="#14"><b class="cmd">ns_conn driver</b></a></li>
<li><a href="#15"><b class="cmd">ns_conn encoding</b> <span class="opt">?<i class="arg">encoding</i>?</span></a></li>
<li><a href="#16"><b class="cmd">ns_conn fileheaders</b> <i class="arg">file</i></a></li>
<li><a href="#17"><b class="cmd">ns_conn filelength</b> <i class="arg">file</i></a></li>
<li><a href="#18"><b class="cmd">ns_conn fileoffset</b> <i class="arg">file</i></a></li>
<li><a href="#19"><b class="cmd">ns_conn files</b></a></li>
<li><a href="#20"><b class="cmd">ns_conn flags</b></a></li>
<li><a href="#21"><b class="cmd">ns_conn form</b></a></li>
<li><a href="#22"><b class="cmd"><a href="../../index.html#key99">ns_conn headers</a></b></a></li>
<li><a href="#23"><b class="cmd">ns_conn host</b></a></li>
<li><a href="#24"><b class="cmd">ns_conn id</b></a></li>
<li><a href="#25"><b class="cmd">ns_conn isconnected</b></a></li>
<li><a href="#26"><b class="cmd">ns_conn keepalive</b> <span class="opt">?<i class="arg">value</i>?</span></a></li>
<li><a href="#27"><b class="cmd">ns_conn location</b></a></li>
<li><a href="#28"><b class="cmd">ns_conn method</b></a></li>
<li><a href="#29"><b class="cmd">ns_conn outputheaders</b></a></li>
<li><a href="#30"><b class="cmd">ns_conn  peeraddr</b></a></li>
<li><a href="#31"><b class="cmd">ns_conn  peerport</b></a></li>
<li><a href="#32"><b class="cmd">ns_conn pool</b></a></li>
<li><a href="#33"><b class="cmd">ns_conn port</b></a></li>
<li><a href="#34"><b class="cmd">ns_conn protocol</b></a></li>
<li><a href="#35"><b class="cmd">ns_conn query</b></a></li>
<li><a href="#36"><b class="cmd">ns_conn request</b></a></li>
<li><a href="#37"><b class="cmd">ns_conn server</b></a></li>
<li><a href="#38"><b class="cmd">ns_conn sock</b></a></li>
<li><a href="#39"><b class="cmd">ns_conn start</b></a></li>
<li><a href="#40"><b class="cmd">ns_conn status</b> <span class="opt">?<i class="arg">value</i>?</span></a></li>
<li><a href="#41"><b class="cmd">ns_conn timeout</b></a></li>
<li><a href="#42"><b class="cmd">ns_conn url</b></a></li>
<li><a href="#43"><b class="cmd">ns_conn urlc</b></a></li>
<li><a href="#44"><b class="cmd">ns_conn urlencoding</b> <span class="opt">?<i class="arg">encoding</i>?</span></a></li>
<li><a href="#45"><b class="cmd">ns_conn urlv</b></a></li>
<li><a href="#46"><b class="cmd">ns_conn version</b></a></li>
<li><a href="#47"><b class="cmd">ns_conn zipaccepted</b></a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>This command is used to retrieve various pieces of information about a connection.</p>
</div>
<div id="section2" class="section"><h2><a name="section2">COMMANDS</a></h2>
<dl class="definitions">
<dt><a name="1"><b class="cmd">ns_conn</b> <i class="arg">option</i> <span class="opt">?<i class="arg">arg arg ...</i>?</span></a></dt>
<dd></dd>
</dl>
<p>The subcommands of ns_conn are (in alphabetical order):</p>
<dl class="definitions">
<dt><a name="2"><b class="cmd">ns_conn auth</b></a></dt>
<dd><p>Returns all authorization headers as a ns_set. For Basic authentication
there are reserved keys: Username and Password, these are the keys returned by ns_conn authuser and
ns_conn authpassword. This ns_set can be updated.</p></dd>
<dt><a name="3"><b class="cmd">ns_conn authpassword</b></a></dt>
<dd><p>Returns the decoded user password from the authorization data.</p></dd>
<dt><a name="4"><b class="cmd">ns_conn authuser</b></a></dt>
<dd><p>Returns the decoded user name from the authorization data.</p></dd>
<dt><a name="5"><b class="cmd">ns_conn channel</b></a></dt>
<dd><p>Returns the Tcl channel name for the current connection.</p></dd>
<dt><a name="6"><b class="cmd">ns_conn clientdata</b> <span class="opt">?<i class="arg">value</i>?</span></a></dt>
<dd><p>Query or set the client date of the current connection. The client
data is provided by the application and is potentially passed to
different threads and can be used to establish the context with the
connection thread. For example, the writer thread outputs the client
data when listing running connections (one can determine e.g. which
user has initiated the delivery, etc.).</p></dd>
<dt><a name="7"><b class="cmd">ns_conn close</b></a></dt>
<dd><p>Closes the connection so the script (or ADP) can do any time-consuming processing
without making the client wait. If you use ns_conn close in an ADP, streaming
should be turned on before closing the connection (i.e. &lt;SCRIPT RUNAT=SERVER STREAM=ON&gt;)
or nothing will get sent out at all.</p></dd>
<dt><a name="8"><b class="cmd">ns_conn compress</b> <span class="opt">?<i class="arg">level</i>?</span></a></dt>
<dd><p>Either set or query the compression level for the current connection.
Use <b class="cmd">ns_conn compress 0</b> to indicate that compression should be
deactivated</p></dd>
<dt><a name="9"><b class="cmd">ns_conn content</b> <span class="opt">?<b class="option">-binary</b>?</span> <span class="opt">?<i class="arg">offset</i>?</span> <span class="opt">?<i class="arg">length</i>?</span></a></dt>
<dd><p>Returns the content of the HTTP request body, optionally a substring
of that content starting at offset and extending length
characters. If the option <b class="option">-binary</b> is used, the content is
returned raw. Otherwise, a conversion to the encoding of the connection
is performed.
Note that the client response might be returned as string
content (as retrieved by this command) or as file 
(see <b class="cmd">ns_conn contentfile</b> ).</p></dd>
<dt><a name="10"><b class="cmd">ns_conn contentfile</b></a></dt>
<dd><p>Returns name of the temporary file which holds contents of the
request. Whether of not a content files is returned depends on the
configuration settings.</p></dd>
<dt><a name="11"><b class="cmd">ns_conn contentlength</b></a></dt>
<dd><p>Returns the number of bytes in the content passed in.</p></dd>
<dt><a name="12"><b class="cmd">ns_conn contentsentlength</b> <span class="opt">?<i class="arg">bytes</i>?</span></a></dt>
<dd><p>Returns or sets the number of bytes in the content to be sent.</p></dd>
<dt><a name="13"><b class="cmd">ns_conn copy</b> <i class="arg">off</i> <i class="arg">len</i> <i class="arg">chan</i></a></dt>
<dd><p>Copies data from the current connection to chan starting at byte off
for len bytes.</p></dd>
<dt><a name="14"><b class="cmd">ns_conn driver</b></a></dt>
<dd><p>Returns the name of the module (nssock or nsssl) that is acting as the
communications driver for this connection.</p></dd>
<dt><a name="15"><b class="cmd">ns_conn encoding</b> <span class="opt">?<i class="arg">encoding</i>?</span></a></dt>
<dd><p>Query or set the encoding for the current connection.</p></dd>
<dt><a name="16"><b class="cmd">ns_conn fileheaders</b> <i class="arg">file</i></a></dt>
<dd><p>Return the header information for the uploaded file with the specified
name (returned via [ns_conn files]).</p></dd>
<dt><a name="17"><b class="cmd">ns_conn filelength</b> <i class="arg">file</i></a></dt>
<dd><p>Return the length of the uploaded file with the specified
name (returned via [ns_conn files]).</p></dd>
<dt><a name="18"><b class="cmd">ns_conn fileoffset</b> <i class="arg">file</i></a></dt>
<dd><p>Return the offset of the uploaded file with the specified
name (returned via [ns_conn files]).</p></dd>
<dt><a name="19"><b class="cmd">ns_conn files</b></a></dt>
<dd><p>Return files uploaded with the current form.</p></dd>
<dt><a name="20"><b class="cmd">ns_conn flags</b></a></dt>
<dd><p>Return the internal flags of the current connection. Use with care,
the flags might change over versions.</p></dd>
<dt><a name="21"><b class="cmd">ns_conn form</b></a></dt>
<dd><p>Returns any submitted form data as an ns_set. This form data may have been submitted
with a POST or appended to the URL in a GET request. Note: ns_conn form is not suitable
for multipart formdata file upload widgets.</p></dd>
<dt><a name="22"><b class="cmd"><a href="../../index.html#key99">ns_conn headers</a></b></a></dt>
<dd><p>Returns all the header data as an ns_set. The keys of the ns_set represent the field
names. The case of the returned field names depends on the HeaderCase configuration
parameter. By default, HeaderCase is &quot;Preserve&quot;, which means case is preserved.</p></dd>
<dt><a name="23"><b class="cmd">ns_conn host</b></a></dt>
<dd><p>Returns the host part of the URL in the HTTP request line. This is
only set, when the NaviServer is used as a proxy server.</p></dd>
<dt><a name="24"><b class="cmd">ns_conn id</b></a></dt>
<dd><p>Returns the unique identifier of the current connection.</p></dd>
<dt><a name="25"><b class="cmd">ns_conn isconnected</b></a></dt>
<dd><p>Returns 1 if you're in a connection thread, and you are therefore allowed to make
calls to ns_conn. It returns 0 if you're not in a connection thread (such as when
you're in a schedule procedure) and you are not allowed to make calls to ns_conn.</p></dd>
<dt><a name="26"><b class="cmd">ns_conn keepalive</b> <span class="opt">?<i class="arg">value</i>?</span></a></dt>
<dd><p>Query or set the keepalive for the current connection.</p></dd>
<dt><a name="27"><b class="cmd">ns_conn location</b></a></dt>
<dd><p>Returns the location string for this virtual server in the form:
protocol://hostname[:port].</p></dd>
<dt><a name="28"><b class="cmd">ns_conn method</b></a></dt>
<dd><p>Returns the HTTP method, e.g. GET.</p></dd>
<dt><a name="29"><b class="cmd">ns_conn outputheaders</b></a></dt>
<dd><p>Returns an ns_set containing the headers that will be sent out when a result is returned
to the client. This ns_set can be manipulated like any other ns_set. You can also use this
command to write to the set of output headers. For example: ns_set put [ns_conn outputheaders] key value.</p></dd>
<dt><a name="30"><b class="cmd">ns_conn  peeraddr</b></a></dt>
<dd><p>Returns the IP address of the client, i.e. the &quot;other side&quot; of the HTTP connection. The
IP address is returned in the form of a string separated with periods (e.g., 155.164.59.75).</p></dd>
<dt><a name="31"><b class="cmd">ns_conn  peerport</b></a></dt>
<dd><p>Returns the port of the client, i.e. the &quot;other side&quot; of the HTTP connection.</p></dd>
<dt><a name="32"><b class="cmd">ns_conn pool</b></a></dt>
<dd><p>Returns the current connection pool from the currently connected server.</p></dd>
<dt><a name="33"><b class="cmd">ns_conn port</b></a></dt>
<dd><p>Returns the port specified explicitly in the URL of the HTTP request. If the browser does
not explicitly send the &quot;:port&quot; part of the URL, the port number returned will be 0.</p></dd>
<dt><a name="34"><b class="cmd">ns_conn protocol</b></a></dt>
<dd><p>Returns the protocol of the URL in the HTTP request line.
This is only set, when the NaviServer is used as a proxy server.</p></dd>
<dt><a name="35"><b class="cmd">ns_conn query</b></a></dt>
<dd><p>Returns any query data that was part of the HTTP request.</p></dd>
<dt><a name="36"><b class="cmd">ns_conn request</b></a></dt>
<dd><p>Returns the HTTP request line as presented by the client, e.g. GET / HTTP/1.1.</p></dd>
<dt><a name="37"><b class="cmd">ns_conn server</b></a></dt>
<dd><p>Returns the name of the server handling the request.</p></dd>
<dt><a name="38"><b class="cmd">ns_conn sock</b></a></dt>
<dd><p>Returns the socket id (integer fd) of current connection.</p></dd>
<dt><a name="39"><b class="cmd">ns_conn start</b></a></dt>
<dd><p>Returns the time the connection request started in &quot;sec:usec&quot; (aka
ns_time) format.</p></dd>
<dt><a name="40"><b class="cmd">ns_conn status</b> <span class="opt">?<i class="arg">value</i>?</span></a></dt>
<dd><p>Query or set the HTTP status code for the current connection.</p></dd>
<dt><a name="41"><b class="cmd">ns_conn timeout</b></a></dt>
<dd><p>Returns absolute time value beyond which conn should not wait on
resources, such as condition variables.</p></dd>
<dt><a name="42"><b class="cmd">ns_conn url</b></a></dt>
<dd><p>Returns the URL of the HTTP request. This is the portion of the request after the
hostname, for example [ns_conn url] on  returns /index.adp.</p></dd>
<dt><a name="43"><b class="cmd">ns_conn urlc</b></a></dt>
<dd><p>Returns the number of elements (delimited by `/') in the URL of the HTTP request.</p></dd>
<dt><a name="44"><b class="cmd">ns_conn urlencoding</b> <span class="opt">?<i class="arg">encoding</i>?</span></a></dt>
<dd><p>Query or set the url encoding for the current connection.</p></dd>
<dt><a name="45"><b class="cmd">ns_conn urlv</b></a></dt>
<dd><p>Returns a list containing the pieces of the URL delimited by `/'.</p></dd>
<dt><a name="46"><b class="cmd">ns_conn version</b></a></dt>
<dd><p>Returns the version of the HTTP request. This is usually 1.0 or 1.1.</p></dd>
<dt><a name="47"><b class="cmd">ns_conn zipaccepted</b></a></dt>
<dd><p>Returns 0 or 1 depending on whether or not the client accepts a zip
encoded response.</p></dd>
</dl>
</div>
<div id="section3" class="section"><h2><a name="section3">EXAMPLES</a></h2>
<pre class="example">
if { [string match /page/* [ns_conn url]] } {
  ns_returnnotfound
}
</pre>
</div>
<div id="see-also" class="section"><h2><a name="see-also">See Also</a></h2>
<p><a href="ns_adp.html">ns_adp</a>, <a href="ns_getform.html">ns_getform</a>, <a href="ns_queryget.html">ns_queryget</a>, <a href="ns_time.html">ns_time</a></p>
</div>
<div id="keywords" class="section"><h2><a name="keywords">Keywords</a></h2>
<p><a href="../../index.html#key119">connection</a>, <a href="../../index.html#key83">gzip</a></p>
</div>
<div id="man-footer">
  
</div>
</div></body></html>
