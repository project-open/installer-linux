
<html><head>
<title>ns_connchan - NaviServer Built-in Commands</title>
<link rel="stylesheet" href="../man.css" type="text/css">
</head>
<! -- Generated from file '/usr/local/src/naviserver/doc/html/naviserver/files/ns_connchan.html' by tcllib/doctools with format 'html'
   -->
<! -- CVS: $Id$ ns_connchan.n
   -->
<body><div class="doctools">
<div id="man-header">
  <a href="http://wiki.tcl.tk/2090"><img
     src="http://naviserver.sourceforge.net/ns-icon-16.png"> <strong>NaviServer</strong></a>
  - programmable web server
</div>
<br>
<hr> [
  <a href="../../toc.html">Main Table Of Contents</a>
| <a href="../toc.html">Table Of Contents</a>
| <a href="../../index.html">Keyword Index</a>
] <hr>
<h1 class="title">ns_connchan(n) 4.99.8 naviserver &quot;NaviServer Built-in Commands&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>ns_connchan - Manage connection channels.</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">COMMANDS</a></li>
<li class="section"><a href="#see-also">See Also</a></li>
<li class="section"><a href="#keywords">Keywords</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="syntax">
<li><a href="#1"><b class="cmd">ns_connchan detach</b></a></li>
<li><a href="#2"><b class="cmd">ns_connchan close</b> <i class="arg">channel</i></a></li>
<li><a href="#3"><b class="cmd">ns_connchan list</b> <span class="opt">?<b class="option">-server <i class="arg">server</i></b>?</span></a></li>
<li><a href="#4"><b class="cmd">ns_connchan callback</b> <span class="opt">?<b class="option">-timeout <i class="arg">s</i></b>?</span> <span class="opt">?<b class="option">-receivetimeout <i class="arg">s</i></b>?</span> <span class="opt">?<b class="option">-sendtimeout <i class="arg">s</i></b>?</span> <i class="arg">channel</i> <i class="arg">command</i> <i class="arg">when</i></a></li>
<li><a href="#5"><b class="cmd">ns_connchan read</b> <i class="arg">channel</i></a></li>
<li><a href="#6"><b class="cmd">ns_connchan write</b> <i class="arg">channel</i> <i class="arg">string</i> 	</a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>The command <b class="cmd">ns_connchan</b> allows to detach the
 current channel from a connection thread and manage the connection
 outside the initiating connection thread. It allows to write or read
 to the channel, to define callbacks and to list open connections and
 to close the connection. The read and write operations on this
 channel will use directly the driver infrastructure which was in use
 during the detach command.</p>
<p>The command allows e.g. to read from and to write to all
 network drivers (such as plain HTTP channels and from SSL/TLS
 connections). It can be used to implement e.g. websockets or
 ansynchronous deliveries (e.g. h264 streams) including secure
 connections. This makes it more powerful than the approaches based on
 <b class="cmd">ns_conn channel</b> using plain Tcl channels.</p>
<p>NaviServer maintains an internal table per server to keep track of
 the detached connection channels and to offer introspection to the
 state of the detached channels.</p>
</div>
<div id="section2" class="section"><h2><a name="section2">COMMANDS</a></h2>
<dl class="definitions">
<dt><a name="1"><b class="cmd">ns_connchan detach</b></a></dt>
<dd><p>The command <b class="cmd">connchan detach</b> unplugs the connection channel from
 the current connection thread and stores it with a fresh handle name
 in a per-virtual-server private table. The command returns the
 created handle as result.</p>
<p>After this command was issued in a connection thread all attempts to
 access the connection socket directly (e.g. via <b class="cmd"><a href="ns_write.html">ns_write</a></b>) will fail.</p></dd>
<dt><a name="2"><b class="cmd">ns_connchan close</b> <i class="arg">channel</i></a></dt>
<dd><p>Close the named connection channel.</p></dd>
<dt><a name="3"><b class="cmd">ns_connchan list</b> <span class="opt">?<b class="option">-server <i class="arg">server</i></b>?</span></a></dt>
<dd><p>Return a list the currently detached connection channels for the
  current or named <i class="arg">server</i>.</p>
<p>Every list entry contains</p>
<ul class="itemized">
	
<li><p>name of the channel</p></li>
<li><p>name of the thread</p></li>
<li><p>start time of the initiating request,</p></li>
<li><p>driver,</p></li>
<li><p>the ip-address of the requestor,</p></li>
<li><p>sent bytes,</p></li>
<li><p>received bytes, and</p></li>
<li><p>the client data as provided via [ns_conn clientdata].</p></li>
</ul></dd>
<dt><a name="4"><b class="cmd">ns_connchan callback</b> <span class="opt">?<b class="option">-timeout <i class="arg">s</i></b>?</span> <span class="opt">?<b class="option">-receivetimeout <i class="arg">s</i></b>?</span> <span class="opt">?<b class="option">-sendtimeout <i class="arg">s</i></b>?</span> <i class="arg">channel</i> <i class="arg">command</i> <i class="arg">when</i></a></dt>
<dd><p>Register a Tcl callback for the names connection <i class="arg">channel</i>. The argument
<i class="arg">when</i> consist of one or more characters
of r, w, e, or x, specifying, when the callback should fire.
All timeouts are specified in the form secs:?microsecs?.
When the callback is fired, the specified Tcl command will be called
with two additional arguments, namely the <i class="arg">handle</i> and and
indicator for the reson of the call <i class="arg">when</i>. The value of <i class="arg">when</i>  will be
as follows:</p>
<ul class="itemized">
<li><p>r - the socket is readable</p></li>
<li><p>w - the socket is writeable</p></li>
<li><p>e - the socket has an exceptional condition</p></li>
<li><p>x - the server is shutting down</p></li>
<li><p>t - timeout received</p></li>
</ul></dd>
<dt><a name="5"><b class="cmd">ns_connchan read</b> <i class="arg">channel</i></a></dt>
<dd><p>Read from the specified connection channel.</p></dd>
<dt><a name="6"><b class="cmd">ns_connchan write</b> <i class="arg">channel</i> <i class="arg">string</i> 	</a></dt>
<dd><p>Write to the specified connection channel.</p></dd>
</dl>
</div>
<div id="see-also" class="section"><h2><a name="see-also">See Also</a></h2>
<p><a href="ns_chan.html">ns_chan</a>, <a href="ns_conn.html">ns_conn</a>, <a href="ns_sockcallback.html">ns_sockcallback</a>, <a href="ns_write.html">ns_write</a></p>
</div>
<div id="keywords" class="section"><h2><a name="keywords">Keywords</a></h2>
<p><a href="../../index.html#key101">channels</a>, <a href="../../index.html#key108">driver</a>, <a href="../../index.html#key24">socket</a></p>
</div>
<div id="man-footer">
  
</div>
</div></body></html>
