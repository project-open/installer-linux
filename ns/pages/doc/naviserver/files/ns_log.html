
<html><head>
<title>ns_log - NaviServer Built-in Commands</title>
<link rel="stylesheet" href="../man.css" type="text/css">
</head>
<! -- Generated from file '/usr/local/src/naviserver/doc/html/naviserver/files/ns_log.html' by tcllib/doctools with format 'html'
   -->
<! -- CVS: $Id$ ns_log.n
   -->
<body><div class="doctools">
<div id="man-header">
  <a href="http://wiki.tcl.tk/2090"><img
     src="http://naviserver.sourceforge.net/ns-icon-16.png"> <strong>NaviServer</strong></a>
  - programmable web server
</div>
<br>
<hr> [
  <a href="../../toc.html">Main Table Of Contents</a>
| <a href="../toc.html">Table Of Contents</a>
| <a href="../../index.html">Keyword Index</a>
] <hr>
<h1 class="title">ns_log(n) 4.99.8 naviserver &quot;NaviServer Built-in Commands&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>ns_log - Global server error log</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">COMMANDS</a></li>
<li class="section"><a href="#section3">CONFIGURATION</a></li>
<li class="section"><a href="#section4">EXAMPLES</a></li>
<li class="section"><a href="#see-also">See Also</a></li>
<li class="section"><a href="#keywords">Keywords</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="syntax">
<li><a href="#1"><b class="cmd">ns_log</b> <i class="arg">severity-level</i> <i class="arg">message</i> <span class="opt">?<i class="arg">message ...</i>?</span></a></li>
<li><a href="#2"><b class="cmd">ns_logctl</b> <b class="method">count</b></a></li>
<li><a href="#3"><b class="cmd">ns_logctl</b> <b class="method">flush</b></a></li>
<li><a href="#4"><b class="cmd">ns_logctl</b> <b class="method">get</b></a></li>
<li><a href="#5"><b class="cmd">ns_logctl</b> <b class="method">hold</b></a></li>
<li><a href="#6"><b class="cmd">ns_logctl</b> <b class="method">peek</b></a></li>
<li><a href="#7"><b class="cmd">ns_logctl</b> <b class="method">release</b></a></li>
<li><a href="#8"><b class="cmd">ns_logctl</b> <b class="method">severities</b></a></li>
<li><a href="#9"><b class="cmd">ns_logctl</b> <b class="method">severity</b> <i class="arg">severity-level</i> <span class="opt">?<i class="arg">bool</i>?</span></a></li>
<li><a href="#10"><b class="cmd">ns_logctl</b> <b class="method">stats</b></a></li>
<li><a href="#11"><b class="cmd">ns_logctl</b> <b class="method">truncate</b> <i class="arg">count</i></a></li>
<li><a href="#12"><b class="cmd">ns_logctl</b> <b class="method">register</b> <i class="arg">script</i> <span class="opt">?<i class="arg">script-args ...</i>?</span></a></li>
<li><a href="#13"><b class="cmd">ns_logctl</b> <b class="method">unregister</b> <i class="arg">handle</i></a></li>
<li><a href="#14"><b class="cmd">ns_logroll</b></a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>The running NaviServer process opens a single log file into which all
<em>Notice</em>, <em>Error</em> etc. messages are logged, whether originating
from the server itself or form Tcl scripts and ADP pages.</p>
<p>The built-in set of severity levels can be extended. Logging can be
enabled/disabled at run-time per-severity level. Custom filters can be added to
process log messages.</p>
</div>
<div id="section2" class="section"><h2><a name="section2">COMMANDS</a></h2>
<dl class="definitions">
<dt><a name="1"><b class="cmd">ns_log</b> <i class="arg">severity-level</i> <i class="arg">message</i> <span class="opt">?<i class="arg">message ...</i>?</span></a></dt>
<dd><p>Queue a message for the error log file if the given <i class="arg">severity-level</i> is
enabled. The <i class="arg">message</i> arguments are concatenated with connecting spaces.
The message will reach the log file when the per-thread cache is flushed.</p>
<p>The following are the predefined values of <i class="arg">severity-level</i>.</p>
<dl class="definitions">
<dt>Notice</dt>
<dd><p>Something interesting occurred.</p></dd>
<dt>Warning</dt>
<dd><p>Something that could mean something bad occurred.</p></dd>
<dt>Error</dt>
<dd><p>Something bad occurred.</p></dd>
<dt>Fatal</dt>
<dd><p>Something extremely bad occurred. The server will shut down after
logging this message.</p></dd>
<dt>Bug</dt>
<dd><p>Something occurred that implies that there is a bug in the code.</p></dd>
<dt>Debug</dt>
<dd><p>If debug level logging is enabled the the message is logged.</p></dd>
<dt>Dev</dt>
<dd><p>If dev level logging is enabled the message is logged.</p></dd>
</dl></dd>
<dt><a name="2"><b class="cmd">ns_logctl</b> <b class="method">count</b></a></dt>
<dd><p>Returns a count of buffered messages for the current thread. The
message buffering can be turned on subcommand  <b class="method">hold</b>.</p></dd>
<dt><a name="3"><b class="cmd">ns_logctl</b> <b class="method">flush</b></a></dt>
<dd></dd>
<dt><a name="4"><b class="cmd">ns_logctl</b> <b class="method">get</b></a></dt>
<dd><p>Return all buffered log messages, removing them from the buffer without writing them
to the log file.
Write buffered log messages from the current thread to the log file. Do not
disable buffering enabled by <i class="arg">hold</i>.</p></dd>
<dt><a name="5"><b class="cmd">ns_logctl</b> <b class="method">hold</b></a></dt>
<dd><p>Buffer log messages originating in the current thread indefinitely. Log messages
are no longer written directly to the server log. Use the subcommand
<b class="method">release</b> to disable buffering.</p></dd>
<dt><a name="6"><b class="cmd">ns_logctl</b> <b class="method">peek</b></a></dt>
<dd><p>Return a copy of any buffered log messages for the current thread.</p></dd>
<dt><a name="7"><b class="cmd">ns_logctl</b> <b class="method">release</b></a></dt>
<dd><p>Write buffered log messages from the current thread to the log file and disable
buffering. Future log messages will not be buffered.</p></dd>
<dt><a name="8"><b class="cmd">ns_logctl</b> <b class="method">severities</b></a></dt>
<dd><p>Return a list of available severity-levels. This includes the 7 predefined
levels and those created with <b class="cmd">ns_logctl</b> or via C code.</p></dd>
<dt><a name="9"><b class="cmd">ns_logctl</b> <b class="method">severity</b> <i class="arg">severity-level</i> <span class="opt">?<i class="arg">bool</i>?</span></a></dt>
<dd><p>Return true if the given <i class="arg">severity-level</i> is enabled, false if it is
disabled. If <i class="arg">bool</i> is given it enables/disables the given
<i class="arg">severity-level</i> for all future log messages, server-wide.</p>
<p>If <i class="arg">severity-level</i> does not already exist and <i class="arg">bool</i> is given, then the
new severity is created, enabled or disabled according to <i class="arg">bool</i>. Future
calls to <b class="cmd">ns_log</b> may use new <i class="arg">severity-level</i>.</p></dd>
<dt><a name="10"><b class="cmd">ns_logctl</b> <b class="method">stats</b></a></dt>
<dd><p>Return statistics from calls to <b class="cmd">ns_log</b> by severity-level.</p></dd>
<dt><a name="11"><b class="cmd">ns_logctl</b> <b class="method">truncate</b> <i class="arg">count</i></a></dt>
<dd><p>Discard this threads buffered messages, leaving <i class="arg">count</i> untouched.</p></dd>
<dt><a name="12"><b class="cmd">ns_logctl</b> <b class="method">register</b> <i class="arg">script</i> <span class="opt">?<i class="arg">script-args ...</i>?</span></a></dt>
<dd><p>Register a log filter <i class="arg">script</i> with the given <i class="arg">script-args</i> where
<i class="arg">script</i> should have the signature:
<em>script</em> <i class="arg">severity</i> <i class="arg">timestamp</i> <i class="arg">message</i> <span class="opt">?<i class="arg">script-args ...</i>?</span>.
A <i class="arg">handle</i> will be returned which can be used to unregister the filter script.</p></dd>
<dt><a name="13"><b class="cmd">ns_logctl</b> <b class="method">unregister</b> <i class="arg">handle</i></a></dt>
<dd><p>Unregister the previously registered log filter script identified by
<i class="arg">handle</i>.</p></dd>
<dt><a name="14"><b class="cmd">ns_logroll</b></a></dt>
<dd><p>Roll the server error log. This works whether the configuration parameter
<em>logroll</em> is enabled or not. See <b class="cmd"><a href="ns_rollfile.html">ns_rollfile</a></b> for details of log
rolling.</p></dd>
</dl>
</div>
<div id="section3" class="section"><h2><a name="section3">CONFIGURATION</a></h2>
<p>The error log is configured globally for the whole server process.</p>
<pre class="example">
<b class="cmd">ns_section</b> &quot;ns/parameters&quot;
<b class="cmd">ns_param</b>   ...
</pre>
<p>The following are valid configuration parameters:</p>
<dl class="definitions">
<dt>serverlog</dt>
<dd><p>Path to error log file. If the path is not fully qualified it is assumed to be
relative to the server home directory ([<b class="cmd"><a href="ns_info.html">ns_info</a></b> home]). All the components of
the path must exist. The server will fail to start if the log file cannot be
opened.
Default: logs/nsd.log</p></dd>
<dt>lognotice</dt>
<dd><p>If true, messages of severity-level <em>Notice</em> are enabled.
Default: true.</p></dd>
<dt>logdev</dt>
<dd><p>If true, messages of severity-level <em>Dev</em> are enabled.
Default: false.</p></dd>
<dt>logdebug</dt>
<dd><p>If true messages of severity-level <em>Debug</em> are enabled.
Default: false.</p></dd>
<dt>logusec</dt>
<dd><p>If true, log entries will have timestamps with microsecond resolution.
Default: false.</p></dd>
<dt>logexpanded</dt>
<dd><p>If true, an extra newline is added to each log entry.
Default: false.</p></dd>
<dt>logroll</dt>
<dd><p>If true, the log file will be rolled when the server receives a SIGHUP signal.
Default: true.</p></dd>
<dt>logmaxbackup</dt>
<dd><p>The number of old error log files to keep around if log rolling is enabled.
Default: 10.</p></dd>
</dl>
</div>
<div id="section4" class="section"><h2><a name="section4">EXAMPLES</a></h2>
<p>Equivalent log messages.</p>
<pre class="example">
% <b class="cmd">ns_log</b> notice &quot;Hello World!&quot;
[21/May/1974:15:30:00][12257.40348b90][-command-] Notice: Hello World!
% <b class="cmd">ns_log</b> notice Hello World!
[21/May/1974:15:30:01][12257.40348b90][-command-] Notice: Hello World!
</pre>
<p>Enable debug logging while the server is running.</p>
<pre class="example">
nscp:1&gt; <b class="cmd">ns_log</b> debug testing...
nscp:2&gt; <b class="cmd">ns_logctl</b> severity debug
0
nscp:3&gt; <b class="cmd">ns_logctl</b> severity debug true
1
nscp:4&gt; <b class="cmd">ns_log</b> debug testing...
[01/April/1984:11:11:59][12257.40348b90][-nscp:1-] testing...
</pre>
<p>Report log messages at the end of an ADP page, as well as log them to the error
log file.</p>
<pre class="example">
&lt;h1&gt;An ADP Page&lt;/h1&gt;
&lt;%
  <b class="cmd">ns_logctl</b> hold
  # ... do some stuff here ...
%&gt;
...
&lt;%
  if {[<b class="cmd">ns_logctl</b> count] &gt; 0} {
      <b class="cmd"><a href="ns_adp_append.html">ns_adp_append</a></b> &quot;Log messages:&quot;
      <b class="cmd"><a href="ns_adp_append.html">ns_adp_append</a></b> &quot;&lt;pre&gt;[<b class="cmd">ns_logctl</b> peek]&lt;/pre&gt;&quot;
  }
  <b class="cmd">ns_logctl</b> release
%&gt;
</pre>
<p>Create a new severity-level.</p>
<pre class="example">
nscp:1&gt; <b class="cmd">ns_logctl</b> severities
Notice Warning Error Fatal Bug Debug Dev
nscp:2&gt; <b class="cmd">ns_log</b> my:debug &quot;a debug message&quot;
unknown severity: &quot;my:debug&quot;: should be one of: Notice Warning Error Fatal Bug Debug Dev
nscp:3&gt; <b class="cmd">ns_logctl</b> severity my:debug off
0
nscp:4&gt; <b class="cmd">ns_log</b> my:debug &quot;a debug message&quot;
nscp:5&gt; <b class="cmd">ns_logctl</b> severity my:debug on
0
nscp:6&gt; <b class="cmd">ns_log</b> my:debug &quot;a debug message&quot;
[22/Nov/1963:13:25:00][1899.40349b90][-nscp:1-] my:debug: a debug message
</pre>
</div>
<div id="see-also" class="section"><h2><a name="see-also">See Also</a></h2>
<p>ns_accesslog, <a href="ns_info.html">ns_info</a>, <a href="ns_rollfile.html">ns_rollfile</a></p>
</div>
<div id="keywords" class="section"><h2><a name="keywords">Keywords</a></h2>
<p><a href="../../index.html#key9">configuration</a>, <a href="../../index.html#key47">error</a>, <a href="../../index.html#key48">log</a>, <a href="../../index.html#key46">path</a></p>
</div>
<div id="man-footer">
  
</div>
</div></body></html>
