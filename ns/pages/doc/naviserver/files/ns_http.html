
<html><head>
<title>ns_http - NaviServer Built-in Commands</title>
<link rel="stylesheet" href="../man.css" type="text/css">
</head>
<! -- Generated from file '/usr/local/src/naviserver/doc/html/naviserver/files/ns_http.html' by tcllib/doctools with format 'html'
   -->
<! -- CVS: $Id$ ns_http.n
   -->
<body><div class="doctools">
<div id="man-header">
  <a href="http://wiki.tcl.tk/2090"><img
     src="http://naviserver.sourceforge.net/ns-icon-16.png"> <strong>NaviServer</strong></a>
  - programmable web server
</div>
<br>
<hr> [
  <a href="../../toc.html">Main Table Of Contents</a>
| <a href="../toc.html">Table Of Contents</a>
| <a href="../../index.html">Keyword Index</a>
] <hr>
<h1 class="title">ns_http(n) 4.99.8 naviserver &quot;NaviServer Built-in Commands&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>ns_http - Simple HTTP client functionality</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">COMMANDS</a></li>
<li class="section"><a href="#section3">EXAMPLES</a></li>
<li class="section"><a href="#see-also">See Also</a></li>
<li class="section"><a href="#keywords">Keywords</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="syntax">
<li><a href="#1"><b class="cmd">ns_http cancel</b> <i class="arg">id</i></a></li>
<li><a href="#2"><b class="cmd">ns_http cleanup</b></a></li>
<li><a href="#3"><b class="cmd">ns_http list</b></a></li>
<li><a href="#4"><b class="cmd">ns_http queue</b> <span class="opt">?<i class="arg">-method M</i>?</span> <span class="opt">?<i class="arg">-headers S</i>?</span> <span class="opt">?<i class="arg">-body B</i>?</span> <span class="opt">?<i class="arg">-timeout T</i>?</span> <i class="arg">url</i></a></li>
<li><a href="#5"><b class="cmd">ns_http run</b> <span class="opt">?<i class="arg">-method M</i>?</span> <span class="opt">?<i class="arg">-headers S</i>?</span> <span class="opt">?<i class="arg">-body B</i>?</span> <span class="opt">?<i class="arg">-timeout T</i>?</span> <i class="arg">url</i></a></li>
<li><a href="#6"><b class="cmd">ns_http wait</b> <span class="opt">?<i class="arg">-elapsed varName</i>?</span> <span class="opt">?<i class="arg">-file varName</i>?</span> <span class="opt">?<i class="arg">-headers H</i>?</span> <span class="opt">?<i class="arg">-result varName</i>?</span> <span class="opt">?<i class="arg">-spoolsize int</i>?</span> <span class="opt">?<i class="arg">-status varName</i>?</span> <span class="opt">?<i class="arg">-timeout t</i>?</span> <span class="opt">?<i class="arg">-decompress</i>?</span> <i class="arg">id</i></a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>This command provides a simple HTTP client mechanism. For https client
requests, use the <i class="term">ns_ssl</i> defined by the <i class="term">nsssl</i> module.</p>
</div>
<div id="section2" class="section"><h2><a name="section2">COMMANDS</a></h2>
<dl class="definitions">
<dt><a name="1"><b class="cmd">ns_http cancel</b> <i class="arg">id</i></a></dt>
<dd><p>Cancel queued http request by id (ns_set id of request).</p></dd>
<dt><a name="2"><b class="cmd">ns_http cleanup</b></a></dt>
<dd><p>Cancel all pending http requests</p></dd>
<dt><a name="3"><b class="cmd">ns_http list</b></a></dt>
<dd><p>Return the list of currently running or pending requests in format:
id url done|running ....</p></dd>
<dt><a name="4"><b class="cmd">ns_http queue</b> <span class="opt">?<i class="arg">-method M</i>?</span> <span class="opt">?<i class="arg">-headers S</i>?</span> <span class="opt">?<i class="arg">-body B</i>?</span> <span class="opt">?<i class="arg">-timeout T</i>?</span> <i class="arg">url</i></a></dt>
<dd><p><i class="arg">-method</i>
use the specified HTTP method such as GET or POST or HEAD</p>
<p><i class="arg">-headers</i>
headers is the ns_set ID containing the additional headers to include in the HTTP request.</p>
<p><i class="arg">-body</i>
body is the value which will be sent as the HTTP request body.</p>
<p><i class="arg">-timeout</i>
Timeout for how long to wait for finishing the whole request 
(default 2:0, secs:microsesc)</p>
<p>The command <b class="cmd">ns_http queue</b> opens a connection to the web server
denoted in the <i class="arg">url</i> and returns on success the <i class="arg">id</i> of the HTTP
request, which might be used later in a <b class="cmd">ns_http wait</b> 
or <b class="cmd">ns_http cancel</b> command to refer to this request.</p></dd>
<dt><a name="5"><b class="cmd">ns_http run</b> <span class="opt">?<i class="arg">-method M</i>?</span> <span class="opt">?<i class="arg">-headers S</i>?</span> <span class="opt">?<i class="arg">-body B</i>?</span> <span class="opt">?<i class="arg">-timeout T</i>?</span> <i class="arg">url</i></a></dt>
<dd><p>Send a HTTP reuqest and wait for the result.  The command 
<b class="cmd">ns_http run</b> is similar to <b class="cmd">ns_http queue</b> followed by 
<b class="cmd">ns_http wait</b>.</p></dd>
<dt><a name="6"><b class="cmd">ns_http wait</b> <span class="opt">?<i class="arg">-elapsed varName</i>?</span> <span class="opt">?<i class="arg">-file varName</i>?</span> <span class="opt">?<i class="arg">-headers H</i>?</span> <span class="opt">?<i class="arg">-result varName</i>?</span> <span class="opt">?<i class="arg">-spoolsize int</i>?</span> <span class="opt">?<i class="arg">-status varName</i>?</span> <span class="opt">?<i class="arg">-timeout t</i>?</span> <span class="opt">?<i class="arg">-decompress</i>?</span> <i class="arg">id</i></a></dt>
<dd><p><i class="arg">-elapsed</i>
varName is the name of a variable that should be used to store the elapsed
time for the request from beginning to finish</p>
<p><i class="arg">-file</i>
varName is the name of a variable that will contain the name of the 
temporary file in case the request was larger than <i class="arg">-spoolsize</i></p>
<p><i class="arg">-headers</i>
headers is the ns_set ID which will receive the headers from the HTTP response.</p>
<p><i class="arg">-result</i>
varName is the name of a variable that should be used to store the HTTP response body.</p>
<p><i class="arg">-spoolsize</i>
In case the result is larger than spoolsize, it will be spooled to a
temporary file returned in the variable denoted by <i class="arg">-file</i>.</p>
<p><i class="arg">-status</i>
varName is the name of a variable that should be used to store the HTTP response status</p>
<p><i class="arg">-timeout</i> 
Optional timeout for the <b class="cmd">wait</b> subcommand. The task
might wait for input until the specified timeout for input. Might be
governed by the total timeout specified in the <b class="cmd">queue</b> subcommand.</p>
<p><i class="arg">-decompress</i>
In case the response has a content encoding of gzip, automatically
decompress the result</p>
<p><i class="arg">id</i>
ns_set ID of the HTTP request to wait for.</p>
<p>The command <b class="cmd">ns_http wait</b> specifies, how the results of request
should be delivered and what information should be obtained from the
request in which form. The command waits until the request is
finished. For retrieving large content (e.g. .mp4 files) from a
server, it is recommended to use the <i class="arg">-spoolsize</i> option,
since per default the results are received into memory.</p></dd>
</dl>
</div>
<div id="section3" class="section"><h2><a name="section3">EXAMPLES</a></h2>
<p>First, a minimal example:</p>
<pre class="example">
 % ns_http queue http://www.google.com
 http0
 % ns_http wait -status S -result R http0
 1
</pre>
<p>The second example set a larger timeout on the request, provides
query-headers and returns reply-headers, and spools results to a file,
when the result is larger than 100 bytes.</p>
<pre class="example">
 set queryHeaders [ns_set create]
 set replyHeaders [ns_set create]
 ns_set update $queryHeaders Host localhost
 
 set h [ns_http queue -headers $queryHeaders -timeout 10:0 http://www.google.com]
 ns_http wait -result R -headers $replyHeaders -status S -spoolsize 1000 -file F $h
 
 if {[info exists F]} {
   ns_log notice &quot;Spooled [file size $F] bytes to $F&quot;
   file delete $F
 } else {
   ns_log notice &quot;Got [string length $R] bytes&quot;
 }
</pre>
</div>
<div id="see-also" class="section"><h2><a name="see-also">See Also</a></h2>
<p><a href="ns_httpget.html">ns_httpget</a>, <a href="ns_httppost.html">ns_httppost</a>, <a href="ns_httptime.html">ns_httptime</a>, ns_ssl</p>
</div>
<div id="keywords" class="section"><h2><a name="keywords">Keywords</a></h2>
<p><a href="../../index.html#key17">http-client</a>, <a href="../../index.html#key54">nssock</a></p>
</div>
<div id="man-footer">
  
</div>
</div></body></html>
