
<html><head>
<title>ns_accesslog - NaviServer Module Commands</title>
<link rel="stylesheet" href="../man.css" type="text/css">
</head>
<! -- Generated from file '/usr/local/src/naviserver/doc/html/nslog/files/ns_accesslog.html' by tcllib/doctools with format 'html'
   -->
<! -- CVS: $Id$ ns_accesslog.n
   -->
<body><div class="doctools">
<div id="man-header">
  <a href="http://wiki.tcl.tk/2090"><img
     src="http://naviserver.sourceforge.net/ns-icon-16.png"> <strong>NaviServer</strong></a>
  - programmable web server
</div>
<br>
<hr> [
  <a href="../../toc.html">Main Table Of Contents</a>
| <a href="../toc.html">Table Of Contents</a>
| <a href="../../index.html">Keyword Index</a>
] <hr>
<h1 class="title">ns_accesslog(n) 4.99.8 nslog &quot;NaviServer Module Commands&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>ns_accesslog - Query and control access log parameters</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">COMMANDS</a></li>
<li class="section"><a href="#section3">CONFIGURATION</a></li>
<li class="section"><a href="#section4">EXAMPLES</a></li>
<li class="section"><a href="#see-also">See Also</a></li>
<li class="section"><a href="#keywords">Keywords</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="syntax">
<li><a href="#1"><b class="cmd">ns_accesslog</b> <i class="arg">file</i> <span class="opt">?<i class="arg">new-path</i>?</span></a></li>
<li><a href="#2"><b class="cmd">ns_accesslog</b> <i class="arg">roll</i> <span class="opt">?<i class="arg">new-path</i>?</span></a></li>
<li><a href="#3"><b class="cmd">ns_accesslog</b> <i class="arg">rollfmt</i> <span class="opt">?<i class="arg">time-format</i>?</span></a></li>
<li><a href="#4"><b class="cmd">ns_accesslog</b> <i class="arg">maxbackup</i> <span class="opt">?<i class="arg">keep</i>?</span></a></li>
<li><a href="#5"><b class="cmd">ns_accesslog</b> <i class="arg">flags</i> <span class="opt">?<i class="arg">flags</i>?</span></a></li>
<li><a href="#6"><b class="cmd">ns_accesslog</b> <i class="arg">extendedheaders</i> <span class="opt">?<i class="arg">new-headers</i>?</span></a></li>
<li><a href="#7"><b class="cmd">ns_accesslog</b> <i class="arg">maxbuffer</i> <span class="opt">?<i class="arg">lines</i>?</span></a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>This command controls and configures the access log. It can change
settings at run-time.</p>
</div>
<div id="section2" class="section"><h2><a name="section2">COMMANDS</a></h2>
<dl class="definitions">
<dt><a name="1"><b class="cmd">ns_accesslog</b> <i class="arg">file</i> <span class="opt">?<i class="arg">new-path</i>?</span></a></dt>
<dd><p>Returns the path of the access log for the current virtual server.</p>
<p>If <span class="opt">?<i class="arg">new-path</i>?</span> is given then the old log is closed and the log
re-opened at the new location. All the components of <span class="opt">?<i class="arg">new-path</i>?</span> must
exist. If an error occurs logging will be disabled.</p></dd>
<dt><a name="2"><b class="cmd">ns_accesslog</b> <i class="arg">roll</i> <span class="opt">?<i class="arg">new-path</i>?</span></a></dt>
<dd><p>Roll the access log (see <b class="cmd"><a href="../../naviserver/files/ns_rollfile.html">ns_rollfile</a></b> for details). Keep <i class="term">maxbackup</i>
old log files around.  If <span class="opt">?<i class="arg">new-path</i>?</span> is given then it overrides the
configuration parameter 'file' as the new log file.</p></dd>
<dt><a name="3"><b class="cmd">ns_accesslog</b> <i class="arg">rollfmt</i> <span class="opt">?<i class="arg">time-format</i>?</span></a></dt>
<dd><p>Get the <span class="opt">?<i class="arg">time-format</i>?</span> which is appended to the log file name when
rolling. The format string is as understood by the Tcl <b class="cmd">clock</b> command.
If <span class="opt">?<i class="arg">time-format</i>?</span> is given then it replaces any existing value.</p></dd>
<dt><a name="4"><b class="cmd">ns_accesslog</b> <i class="arg">maxbackup</i> <span class="opt">?<i class="arg">keep</i>?</span></a></dt>
<dd><p>Get the number of backup files which will be kept when log rolling is
enabled. If <span class="opt">?<i class="arg">keep</i>?</span> is given it replaces any existing value.</p></dd>
<dt><a name="5"><b class="cmd">ns_accesslog</b> <i class="arg">flags</i> <span class="opt">?<i class="arg">flags</i>?</span></a></dt>
<dd><p>Return a list of the enabled logging options, or reset the list if a
new set of flags is given. Valid flags are: logcombined,
formattedtime, logpartialtimes, logreqtime, checkforproxy, and
suppressquery. They have the same meaning as the similarly named
configuration parameters.</p></dd>
<dt><a name="6"><b class="cmd">ns_accesslog</b> <i class="arg">extendedheaders</i> <span class="opt">?<i class="arg">new-headers</i>?</span></a></dt>
<dd><p>Return a list of the HTTP headers which will be appended to each entry in the
access log. If <span class="opt">?<i class="arg">new-headers</i>?</span> is given it replaces the existing
setting.</p></dd>
<dt><a name="7"><b class="cmd">ns_accesslog</b> <i class="arg">maxbuffer</i> <span class="opt">?<i class="arg">lines</i>?</span></a></dt>
<dd><p>Set or get the maximum number of lines to buffer before being flushed to the
log file.</p></dd>
</dl>
</div>
<div id="section3" class="section"><h2><a name="section3">CONFIGURATION</a></h2>
<p>The nslog module is loaded per-server.</p>
<pre class="example">
ns_section &quot;ns/server/server1/modules&quot;
ns_param   nslog   nslog.so
ns_section &quot;ns/server/server1/module/nslog&quot;
ns_param   ...
</pre>
<p>The following are valid configuration parameters:</p>
<dl class="definitions">
<dt>file</dt>
<dd><p>String: path to the log file.</p></dd>
<dt>formattedtime</dt>
<dd><p>If true, log the time in common-log-format. Otherwise log seconds since the
epoch. Default: true.</p></dd>
<dt>logcombined</dt>
<dd><p>If true, log the referer and user-agent HTTP headers (NCSA combined
format). Default: true.</p></dd>
<dt>maxbuffer</dt>
<dd><p>The number of log entries to buffer before flushing to the log file. Default: 0.</p></dd>
<dt>rolllog</dt>
<dd><p>If true then the log file will be rolled. Default: true.</p></dd>
<dt>rollhour</dt>
<dd><p>The hour of the day (0-23) to roll the log file if log rolling is enabled.
Default: 0 (midnight).</p></dd>
<dt>maxbackup</dt>
<dd><p>Number of old log files to keep when log rolling is enabled. Default: 100.</p></dd>
<dt>rollonsignal</dt>
<dd><p>If true then the log file will be rolled when the serve receives a SIGHUP
signal. Default: false.</p></dd>
<dt>suppressquery</dt>
<dd><p>If true then the query (everything after the ? in the URL) is not logged.
Default: false.</p></dd>
<dt>checkforproxy</dt>
<dd><p>If true then the value of the X-Forwarded-For HTTP header is logged as the IP
address of the client. Otherwise, the TCP peer address is logged. Only enable
this if you run your own, trusted proxy server. Default: false.</p></dd>
<dt>logpartialtimes</dt>
<dd><p>If true then include the high-resolution start time of the request
together with partial request durations (accept, queue, filter,
run) in the access log.
Default: false.</p></dd>
<dt>logreqtime</dt>
<dd><p>If true then log the total amount of time the request took to run in seconds and
milliseconds.  Default: false.</p></dd>
<dt>extendedheaders</dt>
<dd><p>A space separated list of additional HTTP headers whos value should be logged.
Default: no extra headers are logged.</p></dd>
</dl>
</div>
<div id="section4" class="section"><h2><a name="section4">EXAMPLES</a></h2>
<p>The path of the active access log.</p>
<pre class="example">
nscp:1&gt; <b class="cmd">ns_accesslog</b> file
/home/ns/servers/server1/modules/nslog/access.log
nscp:2&gt; <b class="cmd"><a href="../../naviserver/files/ns_modulepath.html">ns_modulepath</a></b> server1 nslog access.log
/home/ns/servers/server1/modules/nslog/access.log
</pre>
<p>The access log can be rolled manually.</p>
<pre class="example">
nscp:1&gt; ns_accesslog roll
</pre>
<p>Extended logging options can be configured at run-time.</p>
<pre class="example">
nscp:1&gt; <b class="cmd">ns_accesslog</b> flags
logCombined formattedTime
nscp:2&gt; <b class="cmd">ns_accesslog</b> flags {logcombined formattedtime checkforproxy}
logcombined formattedtime checkforproxy
nscp:3&gt; <b class="cmd">ns_accesslog</b> extendedheaders
nscp:4&gt; <b class="cmd">ns_accesslog</b> extendedheaders {Cookie Accept}
Cookie Accept
</pre>
</div>
<div id="see-also" class="section"><h2><a name="see-also">See Also</a></h2>
<p><a href="../../naviserver/files/ns_log.html">ns_log</a>, <a href="../../naviserver/files/ns_rollfile.html">ns_rollfile</a></p>
</div>
<div id="keywords" class="section"><h2><a name="keywords">Keywords</a></h2>
<p><a href="../../index.html#key127">ipaddress</a>, <a href="../../index.html#key48">log</a>, <a href="../../index.html#key46">path</a>, <a href="../../index.html#key126">proxy</a></p>
</div>
<div id="man-footer">
  
</div>
</div></body></html>
